{% extends 'userprofile/base.html' %}
{% load serialize %}

{% block templates %}
    <script id="job_form_template" type="text/template">
        {% include "employer/form_template/job_information.html" %}
    </script>

    <script id="job_upload_document_form_template" type="text/template">
        {% include "employer/form_template/upload_documents.html" %}
    </script>

    <script id="job_select_category_template" type="text/template">
        {% include "employer/form_template/select_category.html" %}
    </script>

{% endblock %}

{% block content %}
    <div class="_content stages">
        <a id="section_top"></a>
        <h1>Post a Job Listing</h1>
        <div class="left">
        <ul class="sections_text">
            <li class="section1 active"><a href="#section/1">Section 1: Job Information</a></li>
            <li class="section2"><a href="#section/2">Section 2: Upload Documents</a></li>
            <li class="section3"><a href="#section/3">Section 3: Select a Category</a></li>
        </ul>
    </div>
        <div class="right">
            <ul class="sections_tab">
                <li class="section1 active"><a href="#section/1">Section 1</a></li>
                <li class="section2"><a href="#section/2">Section 2</a></li>
                <li class="section3"><a href="#section/3">Section 3</a></li>
            </ul>
            <div class="form sections_form">
                <form>
                    <div class="page section1"></div>
                    <div class="page section2" style="display: none;"></div>
                    <div class="page section3" style="display: none;"></div>
                    <script>
                        var job_collection = new (profile_collection_fabric('job'))({% autoescape off %}{{ object|as_json }}{% endautoescape %});
                        job_view = new (profile_view_fabric('job','/'))({
                            el: $('div.page.section1'),
                            collection: job_collection
                        });
                        job_upload_document_view = new (profile_view_fabric('job_upload_document','/'))({
                            el: $('div.page.section2'),
                            collection: new (profile_collection_fabric('job_upload_document'))({% autoescape off %}{{ object.jobuploaddocument_set.all|as_json }}{% endautoescape %})
                        });
                        job_category_view = new (profile_view_fabric('job','/', $('#job_select_category_template'), 'select_category_view'))({
                            el: $('div.page.section3'),
                            collection: job_collection
                        });
                    </script>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block initialize-js %}
    {{ block.super }}
    <script>
        job_upload_document_view.bind('end_render',document_upload);
        function document_upload (){
            $('#support_document_upload_link').on('click',function(){
                $('#support_document_upload').trigger('click');
                return false;
            });
            $('#support_document_upload').fileupload({
                dataType: 'json',
                done: function (e, data) {
                    job_upload_document_view.collection.add(data.result);
                    job_upload_document_view.render();
                }
            });
            $('#full_position_description_upload_link').on('click',function(){
                $('#full_position_description_upload').trigger('click');
                return false;
            });
            $('#full_position_description_upload').fileupload({
                dataType: 'json',
                done: function (e, data) {
                    job_upload_document_view.collection.add(data.result);
                    job_upload_document_view.render();
                }
            });
        }
        document_upload();
    </script>
{% endblock %}